<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="{{ url_for('static' , filename='img/apple-icon.png') }}">
    <link rel="icon" type="image/png" href="{{ url_for('static' , filename='img/iris_logo.jpg') }}">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <link href="{{ url_for('static' , filename='css/bootstrap.min.css') }}" rel="stylesheet" />
    <link href="{{ url_for('static' , filename='css/page_fonts.css') }}" rel="stylesheet"/>
    <link href="{{ url_for('static' , filename='css/open-iconic/font/css/open-iconic-bootstrap.css') }}" rel="stylesheet">
    
    <link href="{{ url_for('static' , filename='css/bootstrap-toggle.min.css') }}" rel="stylesheet" />
    <link href="{{ url_for('static' , filename='js/bootstrap-toggle.min.js') }}" rel="stylesheet" />
    <link href="{{ url_for('static' , filename='css/now-ui-dashboard.css') }}" rel="stylesheet" />
    <link href="https://cdn.pydata.org/bokeh/release/bokeh-1.0.4.min.css"  rel="stylesheet" type="text/css"/>
    <link  href="https://cdn.pydata.org/bokeh/release/bokeh-widgets-1.0.4.min.css" rel="stylesheet" type="text/css"/>
    <link href="https://cdn.pydata.org/bokeh/release/bokeh-tables-1.0.4.min.css" rel="stylesheet" type="text/css"/>
    <script src="https://cdn.pydata.org/bokeh/release/bokeh-1.0.4.min.js"></script>
    <script src="https://cdn.pydata.org/bokeh/release/bokeh-widgets-1.0.4.min.js"></script>
    <script src="https://cdn.pydata.org/bokeh/release/bokeh-tables-1.0.4.min.js"></script>
    
    
    
    <title>
    Iris
    </title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport'/>
    <!--     Fonts and icons     -->
    <!--<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />-->
    
    <link href="{{ url_for('static' , filename='css/all.css') }}" rel="stylesheet" />
    <script href="{{ url_for('static' , filename='js/popper.js') }}" ></script>
    <script src="{{ url_for('static' , filename='js/jquery_331.min.js') }}"></script>
    <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>-->
    <script src="{{ url_for('static' , filename='js/jquery-ui.js') }}"></script>
    <script href="{{ url_for('static' , filename='js/bootstrap.min.js') }}" ></script>
    
    
    
    
  </head>
  <body class="">
    
    <div class="wrapper ">
      <div class="overlay">
        <div class="loader"></div>
      </div>
      <div class="sidebar" data-color="orange">
        <!--
        Tip 1: You can change the color of the sidebar using: data-color="blue | green | orange | red | yellow"
        -->
        <div class="logo">
          <div class="row">
            <img src="{{ url_for('static' , filename='img/iris_logo.jpg') }}" class="center-block" class="img-responsive center-blocks">
            <a href="#" class="simple-text logo-normal">
              &nbsp;&nbsp;Iris
            </a>
          </div>
        </div>
        <div class="sidebar-wrapper">
          <ul class="nav">
            <li class="active ">
              <a href="./dashboard">
                <i class="now-ui-icons design_app"></i>
                <p>Dashboard</p>
              </a>
            </li>
          </ul>
        </div>
      </div>
      <div class="main-panel">
        <!-- Navbar -->
        <div class="content">
          <nav class="navbar navbar-expand-lg navbar-transparent  navbar-absolute bg-primary fixed-top">
            <div class="container-fluid">
              <div class="navbar-wrapper">
                <div class="navbar-toggle">
                  <button type="button" class="navbar-toggler">
                  <span class="navbar-toggler-bar bar1"></span>
                  <span class="navbar-toggler-bar bar2"></span>
                  <span class="navbar-toggler-bar bar3"></span>
                  </button>
                </div>
                <a class="navbar-brand" href="#" style="color: brown">Iris Insights</a>
              </div>
              <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation"
              aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-bar navbar-kebab"></span>
              <span class="navbar-toggler-bar navbar-kebab"></span>
              <span class="navbar-toggler-bar navbar-kebab"></span>
              </button>
              <div class="collapse navbar-collapse justify-content-end" id="navigation">
                <ul class="navbar-nav">
                  
                  <li class="nav-item">
                    <button type="button" class="btn btn-primary"  onclick="getData();">Get Data</button>
                  </li>
                  
                  <li class="nav-item dropdown">
                    
                    
                  </li>
                  
                </ul>
              </div>
            </div>
          </nav>
          <!-- End Navbar -->
          <div class="">
            <canvas id="bigDashboardChart"></canvas>
          </div>
          
          
          <div class="row" id="data" style="display: none;">
            <div class="col-md-12" id= "preview" >
              <div class="card">
                <div class="card-header">
                  <div class="row">
                    <div class="col-md-12">
                      <div class="col-md-12">
                        <div class="row">
                          <h4 class="card-title">Preview:</h4>
                          <div class="col-md-10">
                            <a  href='#' target="_blank" id="show_all"> <button  type="button" class="btn btn-primary float-right">All Data</button></a>
                            
                            <button type="button" class="btn btn-primary float-right" id='show_plot' onclick="showPlot();">Show Plots</button>
                            <a  href='#'> <button id="view_quality" type="button" class="btn btn-primary float-right" onclick="showQuality();">View Quality</button></a>
                          </div>
                          
                          
                        </div>
                      </div>
                    </div>
                    <div class="col-md-12">
                      <div class="table-responsive">
                        <table class="table table-hover" id ="dataTable">
                          <thead id="dataHeader">
                            
                          </thead>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row" id="data_quality" style="display: none;">
            <div class="col-md-12">
              <div class="card">
                <div class="card-header">
                  <div class="row">
                    <div class="col-md-12">
                      <div class="col-md-12">
                        <div class="row">
                          <h4 class="card-title">Quality:</h4>
                          
                          
                        </div>
                      </div>
                    </div>
                    <div class="col-md-12">
                      <div class="table-responsive">
                        <table class="table table-hover" id ="qualityTable">
                          <thead id="qualityHeader">
                            
                          </thead>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Button trigger modal -->
          <div class="row" id='row1_plot'>
            <div class="col-md-6" id="dist" style="display: none;">
              <div class="card">
                <div class="card-header">
                  <div class="row">
                    <div class="col-md-4">
                      <h4 class="card-title">Distribution</h4>
                    </div>
                    <div class="col-md-8">
                      <div class="form-group">
                        <label for="boxparameter">Parameter</label>
                      <select style="position: relative;" id="histparameter"  class="btn btn-primary" onchange="getDistHistPlot($('#histparameter').val());"></select>
                    </div>
                  </div>
                  
                </div>
              </div>
              <div class="card-body" id='distribution' style="width: 500px; height: 350px;">
                
              </div>
            </div>
          </div>
          <div class="col-md-6" id="var" style="display: none;">
            <div class="card">
              <div class="card-header">
                <div class="row">
                  <div class="col-md-4">
                    <h4 class="card-title">Variation</h4>
                  </div>
                  <div class="col-md-8">
                    <div class="form-group">
                      <label for="varXaxis"><b>X</b></label>
                    <select style="position: relative;" id="varXaxis"  class="btn btn-primary" onchange="getVarPlot($('#varXaxis').val(),$('#varYaxis').val());"></select>
                    
                    <label for="varYaxis"><b>Y</b></label>
                  <select style="position: relative;" id="varYaxis"  class="btn btn-primary" onchange="getVarPlot($('#varXaxis').val(),$('#varYaxis').val());"></select>
                </div>
              </div>
            </div>
          </div>
          <div class="card-body" id='variation' style="width: 500px; height: 350px;">
            
          </div>
        </div>
      </div>
      
      
    </div>
    
    <div class="row">
      <div class="col-md-6" id="box" style="display: none;">
        <div class="card">
          <div class="card-header">
            <div class="row">
              <div class="col-md-4">
                <h4 class="card-title">Boxplots</h4>
              </div>
              
              <div class="col-md-8">
                <div class="form-group">
                  <label for="boxparameter">Parameter</label>
                <select style="position: relative;" id="boxparameter"  class="btn btn-primary" onchange="getBoxPlot($('#boxparameter').val());"></select>
              </div>
            </div>
            
          </div>
        </div>
        <div class="card-body" id='boxplot' style="width: 500px; height: 350px;">
          
        </div>
      </div>
    </div>
    <div class="col-md-6" id="corr" style="display: none;">
      <div class="card">
        <div class="card-header">
          <div class="row">
            <div class="col-md-4">
              <h4 class="card-title">Correlation</h4>
            </div>
            
            <div class="col-md-8">
              <div class="form-group">
                <label for="corroptions">Category</label>
              <select style="position: relative;" id="corroptions"  class="btn btn-primary" onchange="getHeatMaps($('#corroptions').val());"></select>
            </div>
          </div>
          
        </div>
      </div>
      <div class="card-body" id= "heatmap" style="width: 500px; height: 350px;">
        
      </div>
    </div>
  </div>
  
</div>
<div class="row">
  <div class="col-md-6" id='enq' style="display: none;">
    <div class="card  card-tasks">
      <div class="card-header ">
        <div class="row">
          <div class="col-md-8">
            <h4 class="card-title">Enquire</h4>
          </div>
          <div class="col-md-4">
            <button style="position: relative;" id="getMatches" type="button" class="btn btn-primary" onclick="getMatches($('#sepal_length').val(),$('#sepal_width').val(),$('#petal_length').val(),$('#petal_width').val(),$('#n_matches').val() );">Get Matches</button>
          </div>
        </div>
      </div>
      <div class="card-body "style="width: 500px; height: 400px;">
        <form action="matchinputs">
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="sepal_length">Sepal Length</label>
                <input type='text' class="form-control" id="sepal_length" >
                
                
                
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label for="petal_width">Sepal Width</label>
                <input type="text" class="form-control" id="sepal_width" >
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="petal_length">Petal Length</label>
                <input type='text' class="form-control" id="petal_length" >
                
                
                
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label for="sepal_width">Petal Width</label>
                <input type="text" class="form-control" id="petal_width" >
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="n_matches">Number of matches</label>
                <select class="btn btn-primary" id="n_matches">
                  <option value=5 >5</option>
                  <option value=10 selected>10</option>
                  <option value=15 >15</option>
                </select>
                <div class='row'>
                  <div class="col-md-12">
                    <div class="form-group">
                      <h4 class="card-title" id='predicted' style="display:none;">Predicted:</h4>
                      <h4 class="card-title" id='prediction'></h4>
                    </div>
                  </div>
                  
                </div>
                
                
                
              </div>
            </div>
            
          </div>
          
          
          
        </div>
      </div>
    </div>
    <div id="search_results" class="col-md-6" style="display: none;">
      <div class="card  card-tasks">
        <div class="card-header ">
          <h4 class="card-title">Search Results</h4>
        </div>
        <div class="card-body " style="width: 500px; height: 400px;">
          
          <div class="col-md-12 offset-md-1">
            
            
            <table class="table table-striped table-bordered" id="resultTable" style="display:block;max-height:350px;overflow-y:auto;">
              <thead class="text-primary" id='resultHeader'>
                
              </thead>
            <tbody  id= "resultTableBody" ></tbody>
            
          </table>
        </div>
        
        
        
        
        
      </div>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-md-6" id="actual_class_dist" style="display: none;">
    <div class="card">
      <div class="card-header">
        <div class="row">
          <div class="col-md-8">
            <h4 class="card-title">Actual Class Distibution</h4>
          </div>
          
          
          
        </div>
      </div>
      <div class="card-body" id='pred_dist' style="width: 500px; height: 350px;">
        
      </div>
    </div>
  </div>
  <div class="col-md-6" id="feature_variation" style="display: none;">
    <div class="card">
      <div class="card-header">
        <div class="row">
          <div class="col-md-8">
            <h4 class="card-title">Feature variation</h4>
          </div>
          
          
          
        </div>
      </div>
      <div class="card-body" id= "pred_var" style="width: 500px; height: 350px;">
        
      </div>
    </div>
  </div>
  
</div>
<!--   Core JS Files   -->
<script src="{{ url_for('static' , filename='js/jquery-ui.js') }}"></script>
<script src="{{ url_for('static' , filename='js/core/bootstrap.min.js') }}"></script>
<script src="{{ url_for('static' , filename='js/plugins/perfect-scrollbar.jquery.min.js') }}"></script>
<!--  Notifications Plugin    -->
<script src="{{ url_for('static' , filename='js/plugins/bootstrap-notify.js') }}"></script>
<!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example pages etc -->
<script src="{{ url_for('static' , filename='js/now-ui-dashboard.min.js') }}" type="text/javascript"></script>
<!--  Notifications Plugin    -->
<script src="{{ url_for('static' , filename='js/plugins/bootstrap-notify.js') }}"></script>
<!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example pages etc -->
<!--<script src="{{ url_for('static' , filename='js/now-ui-dashboard.min.js') }}" type="text/javascript"></script>-->
<script>
$(document).ready(function(){
$('[data-toggle="tooltip"]').tooltip();
});
function getData(){
$.ajax({
type: 'GET',
contentType: 'application/json',
url: 'dashboard/getData',
success: function (data) {
var columns = data["columns"];
var preview=data["data"];
var dataName=data['data_name'];
var categories=data['categories'];
var quality_data=data['quality_data'];
var quality_columns=data['quality_columns'];
var quality_parameters=data['quality_params'];
setOptions(columns.slice(0,-1),'histparameter');
setOptions(columns.slice(0,-1),'varXaxis');
setOptions(columns.slice(0,-1).reverse(),'varYaxis');
setOptions(columns.slice(0,-1),'boxparameter');
setOptions(categories,'corroptions');
setDataTable(preview, columns , dataName);
// display the Data preview
setQualityTable(quality_data, quality_columns, quality_parameters)
getDistHistPlot($('#histparameter').val());
getVarPlot($('#varXaxis').val(),$('#varYaxis').val());
getBoxPlot($('#boxparameter').val());
getHeatMaps($('#corroptions').val())
$('#data').show();
}
})
}
function setOptions(options , elementName)
{
$("#"+elementName).find('option').remove()
for (i=0;i<options.length; i++)
  {
  $("#"+elementName).append(new Option(options[i], options[i]));
  }}
  function setDataTable(data, columns, dataName)
  {
  $("#dataTable tr").remove();
  $("#dataTable th").remove();
  $("#dataTable td").remove();
  $('#dataHeader').append( '<tr class="table-active">');
    for (i =0 ; i<columns.length ; i++)
    {
    $('#dataHeader').append('<th>'+columns[i]+'</th>')
    }
  $('#dataHeader').append( '</tr>');
  for ( i=0 ; i<5 ; i++)
  {
  $('#dataTable').append( '<tr>');
    for (j=0;j<columns.length; j++)
    {
    $('#dataTable').append('<td>'+data[i][j]+'</td>');
    }
  $('#dataTable').append( '</tr>');
  }
  document.getElementById('show_all').href='/data?dataName='+dataName;
  }
  function setQualityTable(data, columns, parameters)
  {
  $("#qualityTable tr").remove();
  $("#qualityTable th").remove();
  $("#qualityTable td").remove();
  $('#qualityHeader').append( '<tr class="table-active">');
    $('#qualityHeader').append('<th>Parameter</th>')
    for (i =0 ; i<columns.length ; i++)
    {
    $('#qualityHeader').append('<th>'+columns[i]+'</th>')
    }
  $('#qualityHeader').append( '</tr>');
  for ( i=0 ; i<data.length ; i++)
  {
  $('#qualityTable').append( '<tr>');
    $('#qualityTable').append('<td>'+parameters[i]+'</td>');
    for (j=0;j<columns.length; j++)
    {
    $('#qualityTable').append('<td>'+data[i][j].toFixed(2)+'</td>');
    }
  $('#qualityTable').append( '</tr>');
  }
  }
  function getDistHistPlot(value)
  {
  parameter={};
  parameter.parameter=value;
  $.ajax({
  type: 'POST',
  contentType: 'application/json',
  url: 'dashboard/dist_hist',
  data:JSON.stringify(parameter),
  success: function (data) {
  //$('#testplot').append(data['html']);
  graph_data=JSON.parse(data);
  $('#distribution').empty();
  Bokeh.embed.embed_item(graph_data , 'distribution')
  }
  })
  }
  function showPlot()
  {
  if($('#show_plot').html()=='Show Plots')
  {$('#dist').show();
  $('#var').show();
  $('#box').show();
  $('#corr').show();
  $('#enq').show();
  $('#show_plot').html('Hide Plots');
  }
  else
  {
  $('#dist').hide();
  $('#var').hide();
  $('#box').hide();
  $('#corr').hide();
  $('#show_plot').html('Show Plots');
  }
  }
  function showQuality()
  {
  if($('#view_quality').html()=='View Quality')
  {$('#data_quality').show();
  $('#view_quality').html('Hide Quality');
  }
  else
  {
  $('#data_quality').hide();
  $('#view_quality').html('View Quality');
  }
  }
  function getVarPlot(xAxis,yAxis)
  { axes={};
  axes.xaxis=xAxis;
  axes.yaxis=yAxis;
  $.ajax({
  type: 'POST',
  contentType: 'application/json',
  url: 'dashboard/get_var',
  data:JSON.stringify(axes),
  success: function (data) {
  graph_data=JSON.parse(data);
  $('#variation').empty();
  Bokeh.embed.embed_item(graph_data , 'variation')
  }
  })
  }
  function getBoxPlot(value)
  {
  parameter={};
  parameter.parameter=value;
  $.ajax({
  type: 'POST',
  contentType: 'application/json',
  url: 'dashboard/get_box',
  data:JSON.stringify(parameter),
  success: function (data) {
  graph_data=JSON.parse(data);
  $('#boxplot').empty();
  Bokeh.embed.embed_item(graph_data , 'boxplot')
  }
  })
  }
  function getHeatMaps(value)
  {
  parameter={};
  parameter.parameter=value;
  $.ajax({
  type: 'POST',
  contentType: 'application/json',
  url: 'dashboard/get_corrheat',
  data:JSON.stringify(parameter),
  success: function (data) {
  graph_data=JSON.parse(data);
  $('#heatmap').empty();
  Bokeh.embed.embed_item(graph_data , 'heatmap')
  }
  })
  }
  function getMatches(sepal_length,sepal_width,petal_length,petal_width,n)
  {
  parameter={};
  if (sepal_length=='')
  { alert('Please Enter a valid value for Sepal Length');
  throw new Error('Error');}
  else
  parameter.sepal_length=sepal_length;
  if(sepal_width=='')
  {alert('Please Enter a valid value for Sepal Width');
  throw new Error('Error');}
  else
  parameter.sepal_width=sepal_width;
  if (petal_length=='')
  {alert('Please Enter a valid value for Petal Length');
  throw new Error('Error');}
  else
  parameter.petal_length=petal_length;
  if (petal_length=='')
  { alert('Please Enter a valid value for Petal Width');
  throw new Error('Error');}
  else
  parameter.petal_width=petal_width;
  parameter.n=n;
  $.ajax({
  type: 'POST',
  contentType: 'application/json',
  url: 'dashboard/get_matches',
  data:JSON.stringify(parameter),
  success: function (data) { 
  setResultTable(data['data'],data['columns'])
  graph_data=data['plot'];
  graph_pred_var=data['plot_pred_var'];
  $('#prediction').html(data['prediction'])
  $('#prediction').css('color',data['color'])
  $('#pred_dist').empty();
  $('#pred_var').empty();
  Bokeh.embed.embed_item(graph_data , 'pred_dist');
  Bokeh.embed.embed_item(graph_pred_var , 'pred_var');
  $('#search_results').show();
  $('#actual_class_dist').show();
  $('#feature_variation').show();
  $('#predicted').show();
  }
  })
  }
  function setResultTable(data,columns)
  {
  $("#resultTable tr").remove();
  $("#resultTable th").remove();
  $("#resultTable td").remove();
  $('#resultHeader').append( '<tr class="table-active">');
    for (i =0 ; i<columns.length ; i++)
    {
    $('#resultHeader').append('<th>'+columns[i]+'</th>')
    }
  $('#resultHeader').append( '</tr>');
  for ( i=0 ; i<data.length; i++)
  {
  $('#resultTableBody').append( '<tr>');
    for (j=0;j<data[i].length; j++)
    {
    $('#resultTableBody').append('<td>'+data[i][j]+'</td>');
    }
  $('#resultTableBody').append( '</tr>');
  }
  }
  </script>
</body>
</html>